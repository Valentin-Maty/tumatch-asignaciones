<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuMatch - Portal de Asignaciones Premium</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B47',
                        secondary: '#E91E63',
                        accent: '#0D9488',
                        dark: '#0F172A',
                        darker: '#1E293B'
                    },
                    fontFamily: {
                        display: ['Orbitron', 'system-ui', 'sans-serif'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'gradient': 'gradient 15s ease infinite',
                        'slide-up': 'slide-up 0.5s ease-out',
                        'fade-in': 'fade-in 0.5s ease-out'
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Colores ultra modernos 2025 */
            --bg-primary: #0A0A0B;
            --bg-secondary: #111113;
            --bg-tertiary: #1A1A1D;
            --accent-purple: #8B5CF6;
            --accent-cyan: #06B6D4;
            --accent-pink: #EC4899;
            --accent-green: #10B981;
            --accent-orange: #F97316;
            --text-primary: #FFFFFF;
            --text-secondary: #A1A1AA;
            --text-muted: #71717A;
            --border-primary: rgba(255, 255, 255, 0.08);
            --border-accent: rgba(139, 92, 246, 0.2);
            --glass-bg: rgba(255, 255, 255, 0.02);
            --glass-border: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Fondo din√°mico ultramoderno */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            z-index: -1;
            animation: gradientShift 20s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Grid pattern overlay */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            animation: gridFloat 30s linear infinite;
        }

        @keyframes gridFloat {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Glass morphism ultramoderno */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(24px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        /* Botones futuristas */
        .btn-modern {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            border: none;
            color: white;
            font-weight: 600;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-modern:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(139, 92, 246, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-modern:hover::before {
            left: 100%;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid rgba(139, 92, 246, 0.5);
            color: var(--accent-purple);
            font-weight: 500;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: var(--accent-purple);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.2);
        }

        /* Tipograf√≠a moderna */
        .heading-xl {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(2.5rem, 5vw, 4.5rem);
            font-weight: 700;
            line-height: 1.1;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-cyan), var(--accent-purple));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .text-gradient {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Cards ultramodernas */
        .card-modern {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card-modern:hover {
            transform: translateY(-8px) rotate(0.5deg);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(139, 92, 246, 0.2);
        }

        .card-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-purple), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card-modern:hover::before {
            opacity: 1;
        }

        /* Stats cards con n√∫meros animados */
        .stat-card {
            position: relative;
            padding: 2rem;
            text-align: center;
        }

        .stat-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Animaciones suaves y modernas */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-slide-up {
            animation: slideInUp 0.6s ease-out;
        }

        .animate-fade-scale {
            animation: fadeInScale 0.5s ease-out;
        }

        /* Animaci√≥n para el indicador de resultados */
        #resultsIndicator {
            transition: all 0.3s ease;
        }

        #resultsCount {
            transition: all 0.2s ease;
        }

        /* Mejoras para cards clickeables */
        .card-modern:hover {
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(139, 92, 246, 0.2);
        }

        .card-modern:active {
            transform: scale(0.98);
        }

        /* Inputs modernos */
        .input-modern {
            background: rgba(15, 15, 15, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border-radius: 0.75rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 1px rgba(255, 255, 255, 0.05);
        }

        .input-modern:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 
                0 0 0 3px rgba(139, 92, 246, 0.1),
                0 8px 25px rgba(0, 0, 0, 0.2),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            background: rgba(15, 15, 15, 0.9);
        }

        /* Mejoras espec√≠ficas para select */
        .input-modern option {
            background: rgba(15, 15, 15, 0.95);
            color: var(--text-primary);
            padding: 8px 12px;
        }

        .input-modern option:hover {
            background: rgba(139, 92, 246, 0.2);
        }

        /* Loading mejorado */
        .loading-modern {
            display: flex;
            gap: 0.25rem;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-purple);
            animation: loadingPulse 1.4s ease-in-out infinite both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loadingPulse {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
        }
    </style>
</head>

<body x-data="{ currentView: 'dashboard' }" class="font-sans antialiased">
    
    <!-- Navigation ultramoderna con tabs -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass-strong border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 via-cyan-500 to-pink-500 p-0.5 animate-pulse">
                                <div class="w-full h-full rounded-2xl bg-black/50 backdrop-blur flex items-center justify-center">
                                    <i class="fas fa-home text-xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-white via-purple-200 to-cyan-200 bg-clip-text text-transparent">
                                TuMatch
                            </h1>
                            <p class="text-xs text-zinc-400 font-medium tracking-wider">PORTAL INMOBILIARIO</p>
                        </div>
                    </div>
                    
                    <!-- Navigation Tabs -->
                    <div class="hidden md:flex items-center space-x-1">
                        <button @click="currentView = 'dashboard'" 
                                :class="currentView === 'dashboard' ? 'bg-purple-500/20 text-purple-300 border-purple-500/50' : 'text-zinc-400 hover:text-white border-transparent hover:border-white/20'"
                                class="px-6 py-3 rounded-xl font-medium border transition-all duration-300 flex items-center space-x-2">
                            <i class="fas fa-chart-pie text-sm"></i>
                            <span>Dashboard</span>
                        </button>
                        <button @click="currentView = 'properties'" 
                                :class="currentView === 'properties' ? 'bg-cyan-500/20 text-cyan-300 border-cyan-500/50' : 'text-zinc-400 hover:text-white border-transparent hover:border-white/20'"
                                class="px-6 py-3 rounded-xl font-medium border transition-all duration-300 flex items-center space-x-2">
                            <i class="fas fa-building text-sm"></i>
                            <span>Propiedades</span>
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center space-x-3">
                    <button onclick="loadData()" class="btn-modern px-6 py-3 rounded-xl font-medium flex items-center space-x-2">
                        <i class="fas fa-sync-alt"></i>
                        <span>Actualizar</span>
                    </button>
                    <button onclick="exportData()" class="btn-outline px-6 py-3 rounded-xl font-medium flex items-center space-x-2">
                        <i class="fas fa-download"></i>
                        <span>Exportar</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-16">
        
        <!-- Dashboard Section -->
        <div x-show="currentView === 'dashboard'" x-transition>
            
            <!-- Dashboard Header -->
            <section class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
                <div class="text-center mb-12">
                    <div class="inline-flex items-center px-4 py-2 rounded-full glass border border-white/10 mb-6 animate-fade-scale">
                        <div class="w-2 h-2 bg-purple-400 rounded-full mr-3 animate-pulse"></div>
                        <span class="text-sm font-medium text-zinc-300">Dashboard Ejecutivo ‚Ä¢ Analytics en Tiempo Real</span>
                    </div>
                    
                    <h1 class="heading-xl animate-slide-up">
                        Centro de Anal√≠ticas
                    </h1>
                    <p class="text-xl text-zinc-400 max-w-3xl mx-auto leading-relaxed animate-slide-up" style="animation-delay: 0.2s">
                        Insights completos de rendimiento inmobiliario y gesti√≥n de corredores
                    </p>
                </div>
                
                <!-- KPI Cards Enhanced -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="card-modern stat-card animate-fade-scale group">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-building text-2xl text-white"></i>
                        </div>
                        <div class="stat-number" id="dash-totalProperties">0</div>
                        <div class="stat-label">Propiedades Activas</div>
                        <div class="mt-2 text-xs text-green-400 flex items-center justify-center">
                            <i class="fas fa-arrow-up mr-1"></i>
                            <span id="properties-growth">0%</span>
                        </div>
                    </div>
                    
                    <div class="card-modern stat-card animate-fade-scale group" style="animation-delay: 0.1s">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-users text-2xl text-white"></i>
                        </div>
                        <div class="stat-number" id="dash-totalCorredores">0</div>
                        <div class="stat-label">Corredores Activos</div>
                        <div class="mt-2 text-xs text-cyan-400 flex items-center justify-center">
                            <i class="fas fa-user-plus mr-1"></i>
                            <span>En l√≠nea</span>
                        </div>
                    </div>
                    
                    <div class="card-modern stat-card animate-fade-scale group" style="animation-delay: 0.2s">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-crown text-2xl text-white"></i>
                        </div>
                        <div class="stat-number" id="dash-totalFirmas">0</div>
                        <div class="stat-label">Team Leaders</div>
                        <div class="mt-2 text-xs text-green-400 flex items-center justify-center">
                            <i class="fas fa-chart-line mr-1"></i>
                            <span id="conversions-today">+0</span> hoy
                        </div>
                    </div>
                    
                </div>
            </section>
            
            <!-- Analytics Grid Completo -->
            <section class="max-w-7xl mx-auto px-6 lg:px-8 mb-12">
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
                    
                    <!-- Team Leaders Chart con KPIs -->
                    <div class="xl:col-span-2 glass-strong rounded-2xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-2">üìä Distribuci√≥n por Team Leader</h3>
                                <p class="text-sm text-zinc-400">Propiedades asignadas por equipo de trabajo</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-gradient-to-r from-purple-500 to-cyan-500 rounded-full"></div>
                                <span class="text-xs text-zinc-400">Propiedades</span>
                            </div>
                        </div>
                        
                        <!-- Chart principal -->
                        <div class="relative h-80 mb-6">
                            <canvas id="teamLeaderChart"></canvas>
                        </div>
                        
                        <!-- KPIs debajo del gr√°fico - Redise√±o mejorado -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                            <!-- Tipos de Propiedades -->
                            <div class="glass-strong rounded-2xl p-6 border border-zinc-700/30">
                                <div class="flex items-center mb-6">
                                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                                        <i class="fas fa-building text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-white">Tipos de Propiedades</h3>
                                        <p class="text-sm text-zinc-400">Distribuci√≥n por categor√≠a</p>
                                    </div>
                                </div>
                                <div class="space-y-4" id="propertyTypesContainer">
                                    <!-- Se llenar√° din√°micamente -->
                                </div>
                            </div>
                            
                            <!-- Tipo de Operaci√≥n -->
                            <div class="glass-strong rounded-2xl p-6 border border-zinc-700/30">
                                <div class="flex items-center mb-6">
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                                        <i class="fas fa-exchange-alt text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-white">Tipo de Operaci√≥n</h3>
                                        <p class="text-sm text-zinc-400">Ventas vs Arriendos</p>
                                    </div>
                                </div>
                                <div class="space-y-4" id="operationTypesContainer">
                                    <!-- Se llenar√° din√°micamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Corredores Ranking -->
                    <div class="glass-strong rounded-2xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-2 flex items-center">
                                    <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-trophy text-white text-sm"></i>
                                    </div>
                                    Top Corredores
                                </h3>
                                <p class="text-sm text-zinc-400">Ranking por cantidad de propiedades</p>
                            </div>
                            <div class="text-xs text-zinc-400 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 px-4 py-2 rounded-full border border-yellow-500/20">
                                üèÜ Hall of Fame
                            </div>
                        </div>
                        <div id="corredorRankingContainer" class="space-y-4">
                            <!-- Se llenar√° din√°micamente con el ranking personalizado -->
                        </div>
                    </div>
                    
                </div>
            </section>

            
            <!-- Activity Feed -->
            <section class="max-w-7xl mx-auto px-6 lg:px-8">
                <div class="glass-strong rounded-2xl p-8">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-clock text-sm text-white"></i>
                        </div>
                        Actividad Reciente
                    </h3>
                    <div id="activity-feed" class="space-y-4">
                        <!-- Activity items will be populated by JavaScript -->
                    </div>
                </div>
            </section>
            
        </div>
        
        <!-- Properties Section -->
        <div x-show="currentView === 'properties'" x-transition>
        
        <!-- Hero Section simplificado -->
        <section class="max-w-7xl mx-auto px-6 lg:px-8 py-12">
            <div class="text-center mb-12">
                <div class="inline-flex items-center px-4 py-2 rounded-full glass border border-white/10 mb-6 animate-fade-scale">
                    <div class="w-2 h-2 bg-cyan-400 rounded-full mr-3 animate-pulse"></div>
                    <span class="text-sm font-medium text-zinc-300">Gesti√≥n de Propiedades ‚Ä¢ Vista Completa</span>
                </div>
                
                <h1 class="heading-xl animate-slide-up">
                    Cat√°logo de Propiedades
                </h1>
                <p class="text-xl text-zinc-400 max-w-3xl mx-auto leading-relaxed animate-slide-up" style="animation-delay: 0.2s">
                    Explora y gestiona todas las propiedades disponibles con informaci√≥n detallada
                </p>
            </div>
        </section>

        <!-- Filters Section ultramoderna -->
        <section class="max-w-7xl mx-auto px-6 lg:px-8 mb-12">
            <div class="glass-strong rounded-2xl p-8 animate-slide-up">
                <div class="flex items-center mb-8">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-cyan-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-sliders-h text-white"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gradient">Filtros Avanzados</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-3">
                        <label class="block text-sm font-semibold text-zinc-300 uppercase tracking-wider">
                            <i class="fas fa-user-tie mr-2 text-purple-400"></i>Corredor
                        </label>
                        <select id="corredorFilter" class="input-modern w-full px-4 py-3 cursor-pointer hover:bg-white/5 transition-all duration-200">
                            <option value="">üè¢ Todos los corredores</option>
                        </select>
                    </div>
                    
                    <div class="space-y-3">
                        <label class="block text-sm font-semibold text-zinc-300 uppercase tracking-wider">
                            <i class="fas fa-crown mr-2 text-cyan-400"></i>Team Leader
                        </label>
                        <select id="teamLeaderFilter" class="input-modern w-full px-4 py-3 cursor-pointer hover:bg-white/5 transition-all duration-200">
                            <option value="">üëë Todos los team leaders</option>
                        </select>
                    </div>
                    
                    <div class="space-y-3">
                        <label class="block text-sm font-semibold text-zinc-300 uppercase tracking-wider">
                            <i class="fas fa-search mr-2 text-emerald-400"></i>B√∫squeda
                        </label>
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="üîç C√≥digo o referido..." 
                                   class="input-modern w-full pl-4 pr-12 py-3 hover:bg-white/5 transition-all duration-200">
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-zinc-400">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Indicador de resultados -->
        <section class="max-w-7xl mx-auto px-6 lg:px-8 mb-8">
            <div id="resultsIndicator" class="glass-strong rounded-xl p-4 flex items-center justify-between animate-slide-up" style="display: none;">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center">
                        <i class="fas fa-list-alt text-white"></i>
                    </div>
                    <div>
                        <p class="text-sm text-zinc-300 font-medium">Propiedades encontradas</p>
                        <p id="resultsCount" class="text-xl font-bold text-gradient">0 propiedades</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 text-xs text-zinc-400">
                    <i class="fas fa-filter"></i>
                    <span id="activeFilters">Todos los resultados</span>
                </div>
            </div>
        </section>

        <!-- Properties Grid ultramoderno -->
        <section class="max-w-7xl mx-auto px-6 lg:px-8">
            
            <!-- Loading State futurista -->
            <div id="loading" class="flex flex-col items-center justify-center py-20" style="display: none;">
                <div class="relative mb-8">
                    <div class="w-20 h-20 rounded-full border-4 border-purple-500/20 animate-spin">
                        <div class="absolute top-0 left-0 w-full h-full rounded-full border-4 border-transparent border-t-purple-500 animate-spin"></div>
                    </div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-home text-2xl text-purple-400 animate-pulse"></i>
                    </div>
                </div>
                <div class="text-center">
                    <h3 class="text-xl font-semibold text-white mb-2">Cargando propiedades</h3>
                    <div class="loading-modern">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Properties Grid responsive -->
            <div id="grid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
                <!-- Properties will be rendered here -->
            </div>

        </section>
        
        </div> <!-- End Properties Section -->
    </main>

    <script>
        // Alpine.js Data
        function appData() {
            return {
                // App state
                loading: false,
                properties: [],
                filteredProperties: [],
                // Stats
                totalProperties: 0,
                totalCorredores: 0,
                totalFirmas: 0,
                conversionRate: 0
            }
        }

        // Global Variables
        const SPREADSHEET_ID = '1X7cbk_fD5mGTXxs1cOa4tCxeXBrpiNWV4sEJnBRwVUM';
        const GID = '1154306850';
        
        let allData = [];
        let filteredData = [];
        
        // Cache de datos de propiedades del XML
        const propertyData = new Map();
        
        // Cache de im√°genes conocidas del XML (basado en an√°lisis previo)
        const propertyImages = new Map([
            // Propiedades con im√°genes reales del XML feed
            ['11', ['https://2clicsalmcl.blob.core.windows.net/chile/8/property-images/2025/2/ee492502-daa0-40c2-b7a9-a978c735a7dd_wm.jpeg']],
            ['12', ['https://2clicsalmcl.blob.core.windows.net/chile/2/property-images/2025/2/e4721799-da23-4531-b09e-44cfd40031e8.jpeg']],
            ['26', ['https://2clicsalmcl.blob.core.windows.net/chile/8/property-images/2025/2/b03edfe0-e2c3-4c51-9f01-18964a1f4ed4_wm.jpeg']],
            ['28', ['https://2clicsalmcl.blob.core.windows.net/chile/8/property-images/2025/2/813d30ab-4827-4296-9747-d79c70b8de1c_wm.jpeg']],
            ['385', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/4/4b89a8fa-4598-4be8-b7ff-de00bfbdb302.jpeg']],
            ['441', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/6f9326f3-f8fa-4176-ba73-6b83d10c974e.jpeg']],
            ['449', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/4b89a8fa-4598-4be8-b7ff-de00bfbdb302.jpeg']],
            ['450', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/c60d6e32-5d13-4ae2-a6de-37dddaad3e8a.jpeg']],
            ['451', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/82e9dfaf-80a8-4b32-9c75-9b47f35fde0d.jpeg']],
            ['452', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/26f14b59-c7d3-4e43-b871-2f75b901e8d1.jpeg']],
            ['453', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/e5e0f4df-fd8a-466d-8dd9-2b8dc2e8fa91.jpeg']],
            ['462', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/a4736b46-6b3b-49a8-87de-c6b7df62b66d.jpeg']],
            // Agregar m√°s basados en c√≥digos comunes que podr√≠an aparecer
            ['387', ['https://2clicsalmcl.blob.core.windows.net/chile/8/property-images/2025/2/ee492502-daa0-40c2-b7a9-a978c735a7dd_wm.jpeg']],
            ['388', ['https://2clicsalmcl.blob.core.windows.net/chile/2/property-images/2025/2/e4721799-da23-4531-b09e-44cfd40031e8.jpeg']],
            ['392', ['https://2clicsalmcl.blob.core.windows.net/chile/8/property-images/2025/2/b03edfe0-e2c3-4c51-9f01-18964a1f4ed4_wm.jpeg']],
            ['393', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/6f9326f3-f8fa-4176-ba73-6b83d10c974e.jpeg']],
            ['394', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/c60d6e32-5d13-4ae2-a6de-37dddaad3e8a.jpeg']],
            ['395', ['https://2clicsalmcl.blob.core.windows.net/chile/73/property-images/2025/5/82e9dfaf-80a8-4b32-9c75-9b47f35fde0d.jpeg']]
        ]);
        
        console.log('üñºÔ∏è Im√°genes precargadas para', propertyImages.size, 'propiedades - Versi√≥n restaurada');
        
        // Funci√≥n para cargar m√°s im√°genes del XML (funciona en producci√≥n)
        async function loadMoreImagesFromXML() {
            try {
                console.log('üåê Intentando cargar XML en producci√≥n...');
                // Usar el endpoint API para evitar CORS
                const response = await fetch('/api/xml-proxy');
                const xmlText = await response.text();
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                const listings = xmlDoc.querySelectorAll('listing');
                
                let newImages = 0;
                listings.forEach(listing => {
                    const referenceId = listing.querySelector('reference_id')?.textContent?.trim();
                    if (referenceId && !propertyImages.has(referenceId)) {
                        const images = [];
                        const picturesElement = listing.querySelector('pictures');
                        if (picturesElement) {
                            const urlElements = picturesElement.querySelectorAll('url');
                            urlElements.forEach(urlElement => {
                                const imageUrl = urlElement.textContent?.trim();
                                if (imageUrl && imageUrl.startsWith('http')) {
                                    images.push(imageUrl);
                                }
                            });
                        }
                        if (images.length > 0) {
                            propertyImages.set(referenceId, images);
                            newImages++;
                        }
                    }
                });
                
                console.log(`‚úÖ XML cargado! ${newImages} nuevas im√°genes agregadas. Total: ${propertyImages.size}`);
                return true;
            } catch (error) {
                console.log('‚ÑπÔ∏è XML no disponible (normal en desarrollo local)');
                return false;
            }
        }
        
        // Funci√≥n para obtener imagen de una propiedad
        function getPropertyImage(codigo) {
            // Extraer n√∫mero del c√≥digo (ej: "TU-2043" -> "2043")
            const matches = codigo.match(/\d+/g);
            if (matches) {
                for (const number of matches) {
                    if (propertyImages.has(number)) {
                        const images = propertyImages.get(number);
                        return images[0]; // Retornar primera imagen
                    }
                }
            }
            
            // Tambi√©n probar el c√≥digo tal como viene
            if (propertyImages.has(codigo)) {
                const images = propertyImages.get(codigo);
                return images[0];
            }
            
            return null;
        }

        // Function to get property data from XML cache
        function getPropertyData(codigo) {
            // Extraer n√∫mero del c√≥digo (ej: "TU-2043" -> "2043")
            const matches = codigo.match(/\d+/g);
            if (matches) {
                for (const number of matches) {
                    if (propertyData.has(number)) {
                        return propertyData.get(number);
                    }
                }
            }
            
            // Tambi√©n probar el c√≥digo tal como viene
            if (propertyData.has(codigo)) {
                return propertyData.get(codigo);
            }
            
            return {};
        }

        // Load property data from XML
        async function loadPropertyDataFromXML() {
            try {
                console.log('üì° Cargando datos adicionales del XML...');
                // Usar el endpoint API para evitar CORS
                const response = await fetch('/api/xml-proxy');
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                const listings = xmlDoc.getElementsByTagName('listing');
                console.log('üè† Total listings en XML:', listings.length);
                
                for (let listing of listings) {
                    const referenceId = listing.getElementsByTagName('reference_id')[0]?.textContent;
                    const title = listing.getElementsByTagName('title')[0]?.textContent;
                    
                    // Extraer informaci√≥n de precios
                    const priceElements = listing.getElementsByTagName('price');
                    let price = null;
                    let operation = null;
                    let currency = null;
                    
                    if (priceElements.length > 0) {
                        const priceElement = priceElements[0];
                        price = priceElement.textContent;
                        operation = priceElement.getAttribute('operation'); // sale/rent
                        currency = priceElement.getAttribute('currency'); // CLP/CLF
                    }
                    
                    // Tipo de propiedad
                    const propertyType = listing.getElementsByTagName('propertyType')[0]?.textContent;
                    
                    // Coordenadas
                    const coordinates = listing.getElementsByTagName('coordinates')[0];
                    let latitude = null;
                    let longitude = null;
                    if (coordinates) {
                        latitude = coordinates.getElementsByTagName('latitude')[0]?.textContent;
                        longitude = coordinates.getElementsByTagName('longitude')[0]?.textContent;
                    }
                    
                    // Informaci√≥n adicional
                    const bedrooms = listing.getElementsByTagName('bedrooms')[0]?.textContent;
                    const bathrooms = listing.getElementsByTagName('bathrooms')[0]?.textContent;
                    const floorArea = listing.getElementsByTagName('floorArea')[0]?.textContent;
                    const plotArea = listing.getElementsByTagName('plotArea')[0]?.textContent;
                    
                    if (referenceId) {
                        propertyData.set(referenceId, {
                            title: title || '',
                            price: price ? parseFloat(price) : null,
                            operation: operation || '',
                            currency: currency || '',
                            propertyType: propertyType || '',
                            latitude: latitude ? parseFloat(latitude) : null,
                            longitude: longitude ? parseFloat(longitude) : null,
                            bedrooms: bedrooms ? parseInt(bedrooms) : null,
                            bathrooms: bathrooms ? parseInt(bathrooms) : null,
                            floorArea: floorArea ? parseFloat(floorArea) : null,
                            plotArea: plotArea ? parseFloat(plotArea) : null
                        });
                    }
                }
                
                console.log('‚úÖ Datos del XML cargados:', propertyData.size, 'propiedades');
                
                // Refresh properties display if data is already loaded
                if (allData.length > 0) {
                    renderProperties();
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è No se pudo cargar datos adicionales del XML (funciona en producci√≥n):', error.message);
            }
        }

        // CSV Parser Function
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // Load Data Function (Original Working Version)
        async function loadData(isAutoRefresh = false) {
            console.log('üîÑ Iniciando carga de datos...');
            const loading = document.getElementById('loading');
            const grid = document.getElementById('grid');
            
            if (!isAutoRefresh) {
                loading.style.display = 'flex';
                grid.style.display = 'none';
            }

            try {
                const CSV_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${GID}`;
                console.log('üì° Fetching CSV from:', CSV_URL);
                
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                
                console.log('üìÑ CSV recibido, tama√±o:', csvText.length);
                console.log('üìÑ Primeras l√≠neas:', csvText.substring(0, 500));
                
                if (!csvText) {
                    throw new Error('No se pudo acceder a los datos.');
                }
                
                const lines = csvText.split('\n').filter(line => line.trim());
                console.log('üìä Total de l√≠neas procesadas:', lines.length);
                
                const newData = [];
                const corredores = new Set();
                const teamLeaders = new Set();

                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    
                    const codigo = values[1]?.trim() || '';
                    const corredor = values[4]?.trim() || '';
                    const teamLeader = values[5]?.trim() || '';
                    const referido = values[6]?.trim() || '';
                    const ordenEnviada = values[7]?.trim() || '';
                    const estado = values[8]?.trim() || '';
                    
                    if (estado) continue;
                    if (!codigo || !corredor) continue;

                    newData.push({
                        codigo,
                        corredor,
                        teamLeader,
                        referido,
                        ordenEnviada
                    });
                    
                    corredores.add(corredor);
                    if (teamLeader && teamLeader.trim()) {
                        teamLeaders.add(teamLeader);
                    }
                }
                
                allData = newData;
                console.log('‚úÖ Datos procesados:', allData.length, 'propiedades');
                console.log('üë• Corredores encontrados:', corredores.size);
                console.log('üëë Team Leaders encontrados:', teamLeaders.size);
                
                updateCorredorFilter(corredores);
                updateTeamLeaderFilter(teamLeaders);
                
                // Initialize with all data shown
                filteredData = allData;
                updateResultsIndicator('', '', '');
                renderProperties();
                updateStats();
                
                console.log('üìà Stats actualizadas');
                
                if (!isAutoRefresh) {
                    showToast('Datos actualizados correctamente', 'success');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showToast('Error al cargar datos', 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Update Corredor Filter
        function updateCorredorFilter(corredores) {
            const select = document.getElementById('corredorFilter');
            const currentValue = select.value;
            
            // Clear existing options
            select.innerHTML = '';
            
            // Add default option with emoji
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'üè¢ Todos los corredores';
            select.appendChild(defaultOption);
            
            // Add unique corredores in alphabetical order
            const uniqueCorredores = [...new Set(corredores)].filter(c => c && c.trim()).sort();
            
            uniqueCorredores.forEach(corredor => {
                const option = document.createElement('option');
                option.value = corredor;
                option.textContent = `üë§ ${corredor}`;
                select.appendChild(option);
            });
            
            // Restore previous value if still valid
            if (uniqueCorredores.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        // Update Team Leader Filter
        function updateTeamLeaderFilter(teamLeaders) {
            const select = document.getElementById('teamLeaderFilter');
            const currentValue = select.value;
            
            // Clear existing options
            select.innerHTML = '';
            
            // Add default option with emoji
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'üëë Todos los team leaders';
            select.appendChild(defaultOption);
            
            // Add "Sin asignar" option for properties without team leader
            const sinAsignarOption = document.createElement('option');
            sinAsignarOption.value = 'SIN_ASIGNAR';
            sinAsignarOption.textContent = '‚ùå Sin asignar';
            select.appendChild(sinAsignarOption);
            
            // Add unique team leaders in alphabetical order
            const uniqueTeamLeaders = [...new Set(teamLeaders)].filter(t => t && t.trim()).sort();
            
            uniqueTeamLeaders.forEach(teamLeader => {
                const option = document.createElement('option');
                option.value = teamLeader;
                option.textContent = `üëë ${teamLeader}`;
                select.appendChild(option);
            });
            
            // Restore previous value if still valid
            if (uniqueTeamLeaders.includes(currentValue) || currentValue === 'SIN_ASIGNAR') {
                select.value = currentValue;
            }
        }

        // Apply Filters
        function applyFilters() {
            const corredorFilter = document.getElementById('corredorFilter').value;
            const teamLeaderFilter = document.getElementById('teamLeaderFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            filteredData = allData.filter(item => {
                const matchesCorredor = !corredorFilter || item.corredor === corredorFilter;
                
                const matchesTeamLeader = !teamLeaderFilter || 
                    (teamLeaderFilter === 'SIN_ASIGNAR' && (!item.teamLeader || !item.teamLeader.trim())) ||
                    (teamLeaderFilter !== 'SIN_ASIGNAR' && item.teamLeader === teamLeaderFilter);
                
                const matchesSearch = !searchInput || 
                    item.codigo.toLowerCase().includes(searchInput) ||
                    (item.referido && item.referido.toLowerCase().includes(searchInput)) ||
                    (item.teamLeader && item.teamLeader.toLowerCase().includes(searchInput)) ||
                    (item.ordenEnviada && item.ordenEnviada.toLowerCase().includes(searchInput));
                
                return matchesCorredor && matchesTeamLeader && matchesSearch;
            });
            
            updateResultsIndicator(corredorFilter, teamLeaderFilter, searchInput);
            renderProperties();
        }

        // Update Results Indicator
        function updateResultsIndicator(corredorFilter, teamLeaderFilter, searchInput) {
            const indicator = document.getElementById('resultsIndicator');
            const countElement = document.getElementById('resultsCount');
            const filtersElement = document.getElementById('activeFilters');
            
            const total = filteredData.length;
            const totalOriginal = allData.length;
            
            // Update count
            if (total === 1) {
                countElement.textContent = '1 propiedad';
            } else {
                countElement.textContent = `${total} propiedades`;
            }
            
            // Build active filters description
            const activeFilters = [];
            if (corredorFilter) {
                activeFilters.push(`Corredor: ${corredorFilter}`);
            }
            if (teamLeaderFilter) {
                if (teamLeaderFilter === 'SIN_ASIGNAR') {
                    activeFilters.push('Team Leader: Sin asignar');
                } else {
                    activeFilters.push(`Team Leader: ${teamLeaderFilter}`);
                }
            }
            if (searchInput) {
                activeFilters.push(`B√∫squeda: "${searchInput}"`);
            }
            
            if (activeFilters.length > 0) {
                filtersElement.textContent = activeFilters.join(' ‚Ä¢ ');
            } else {
                filtersElement.textContent = `Mostrando todas las propiedades (${totalOriginal} total)`;
            }
            
            // Show indicator
            indicator.style.display = 'flex';
        }

        // Render Properties
        function renderProperties() {
            console.log('üè† Renderizando propiedades:', filteredData.length);
            const grid = document.getElementById('grid');
            
            if (filteredData.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="w-20 h-20 mx-auto mb-4 bg-gray-700 rounded-full flex items-center justify-center">
                            <i class="fas fa-search text-2xl text-gray-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-300 mb-2">No se encontraron propiedades</h3>
                        <p class="text-gray-400">Intenta ajustar los filtros de b√∫squeda</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredData.map((item, index) => createPropertyCard(item, index)).join('');
            grid.style.display = 'grid';
        }

        // Create Property Card con informaci√≥n completa de comisiones
        function createPropertyCard(item, index) {
            const gradients = [
                'from-purple-500 via-pink-500 to-red-500',
                'from-blue-500 via-cyan-500 to-teal-500', 
                'from-green-500 via-emerald-500 to-cyan-500',
                'from-orange-500 via-red-500 to-pink-500',
                'from-indigo-500 via-purple-500 to-pink-500',
                'from-cyan-500 via-blue-500 to-indigo-500'
            ];
            const gradient = gradients[index % gradients.length];
            
            // Obtener imagen e informaci√≥n adicional de la propiedad del XML
            const propertyImage = getPropertyImage(item.codigo);
            const xmlData = getPropertyData(item.codigo);
            
            // Formatear precio
            function formatPrice(price, currency, operation) {
                if (!price) return null;
                
                let formattedPrice = '';
                if (currency === 'CLF') {
                    formattedPrice = `UF ${price.toLocaleString('es-CL')}`;
                } else {
                    formattedPrice = `$${price.toLocaleString('es-CL')}`;
                }
                
                const operationText = operation === 'sale' ? 'Venta' : operation === 'rent' ? 'Arriendo' : '';
                return { formattedPrice, operationText };
            }
            
            // Formatear tipo de propiedad
            function formatPropertyType(type) {
                const types = {
                    'house': 'Casa',
                    'apartment': 'Departamento',
                    'land': 'Terreno',
                    'office': 'Oficina',
                    'commercial': 'Comercial'
                };
                return types[type] || type || '';
            }
            
            const priceInfo = formatPrice(xmlData.price, xmlData.currency, xmlData.operation);
            const propertyTypeFormatted = formatPropertyType(xmlData.propertyType);
            
            return `
                <div class="card-modern group cursor-pointer transform hover:scale-[1.02] transition-all duration-500" 
                     onclick="window.open('https://app.2clics.cl/pub/propiedad/${item.codigo.toString().trim().match(/\d+/)?.[0] || ''}', '_blank')">
                    <!-- Imagen de la propiedad con overlay -->
                    <div class="relative h-48 overflow-hidden rounded-t-2xl">
                        ${propertyImage ? 
                            `<img src="${propertyImage}" alt="Propiedad ${item.codigo}" 
                                 class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE5MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMxQTFBMUQ7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMTExMTEzO3N0b3Atb3BhY2l0eToxIiAvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNzE3MTdBIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPvCfj6Ag0KjQvNCw0LPQtdC9INC00LjRgdC/0L7QvdC40LHQu9C1PC90ZXh0Pjwvc3ZnPg=='">` :
                            `<div class="w-full h-full bg-gradient-to-br ${gradient} flex items-center justify-center relative">
                                <i class="fas fa-home text-5xl text-white opacity-30"></i>
                                <div class="absolute inset-0 bg-black/20"></div>
                             </div>`
                        }
                        
                        <!-- Overlay con c√≥digo de propiedad -->
                        <div class="absolute top-3 left-3 right-3 flex justify-between items-start">
                            <div class="glass px-3 py-1.5 rounded-xl backdrop-blur-lg hover:bg-white/20 transition-all duration-200 cursor-pointer">
                                <a href="https://app.2clics.cl/pub/propiedad/${item.codigo.toString().trim().match(/\d+/)?.[0] || ''}" 
                                   target="_blank" 
                                   class="text-lg font-bold text-white hover:text-cyan-300 transition-colors">
                                    ${item.codigo}
                                </a>
                            </div>
                            ${priceInfo ? `
                            <div class="glass px-3 py-1 rounded-lg backdrop-blur-lg">
                                <div class="text-center">
                                    <div class="text-xs text-white/90">${priceInfo.operationText}</div>
                                    <div class="text-sm font-bold text-white">${priceInfo.formattedPrice}</div>
                                </div>
                            </div>` : ''}
                        </div>
                        
                        <!-- Informaci√≥n de propiedad badges -->
                        <div class="absolute bottom-3 left-3 right-3 flex justify-between items-end">
                            ${propertyTypeFormatted ? `
                            <div class="glass px-2 py-1 rounded-lg backdrop-blur-lg">
                                <span class="text-xs text-white font-medium">üè† ${propertyTypeFormatted}</span>
                            </div>` : ''}
                            
                            <div class="glass px-2 py-1 rounded-lg backdrop-blur-lg">
                                <span class="text-xs ${item.teamLeader ? 'text-cyan-300' : 'text-zinc-400'} font-medium">üëë ${item.teamLeader || 'Sin asignar'}</span>
                            </div>
                        </div>
                        
                        <!-- Enlace a propiedad en 2clics (badge central) -->
                        <div class="absolute top-3 left-1/2 transform -translate-x-1/2">
                            <div class="glass px-2 py-1 rounded-lg backdrop-blur-lg">
                                <a href="https://app.2clics.cl/pub/propiedad/${item.codigo.toString().trim().match(/\d+/)?.[0] || ''}" 
                                   target="_blank" 
                                   class="text-xs text-white hover:text-cyan-300 transition-colors flex items-center space-x-1">
                                    <i class="fas fa-external-link-alt"></i>
                                    <span>Ver en 2Clics</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contenido Principal -->
                    <div class="p-5 space-y-4">
                        
                        <!-- Corredor Principal (30% comisi√≥n) -->
                        <div class="flex items-center space-x-3 p-3 rounded-xl bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20">
                            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                                <i class="fas fa-user-tie text-white text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-bold text-white">${item.corredor}</p>
                                <p class="text-xs text-purple-300 font-medium">üí∞ Comisi√≥n: 30%</p>
                            </div>
                        </div>
                        
                        <!-- Referido (5% comisi√≥n) -->
                        <div class="flex items-center space-x-3 p-2.5 rounded-lg ${item.referido && item.referido !== 'TuMatch Inmobiliario' ? 'bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20' : 'bg-zinc-800/30 border border-zinc-700/30'}">
                            <div class="w-8 h-8 rounded-lg ${item.referido && item.referido !== 'TuMatch Inmobiliario' ? 'bg-gradient-to-br from-emerald-500 to-cyan-500' : 'bg-zinc-700'} flex items-center justify-center">
                                <i class="fas fa-handshake text-white text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm ${item.referido && item.referido !== 'TuMatch Inmobiliario' ? 'text-white' : 'text-zinc-400'} font-medium">
                                    ${item.referido && item.referido !== 'TuMatch Inmobiliario' ? item.referido : 'Sin referido'}
                                </p>
                                <p class="text-xs ${item.referido && item.referido !== 'TuMatch Inmobiliario' ? 'text-emerald-300' : 'text-zinc-500'}">
                                    ${item.referido && item.referido !== 'TuMatch Inmobiliario' ? 'üíµ Referido ‚Ä¢ 5%' : '‚ùå Sin datos'}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Orden Enviada a Firmar (5% comisi√≥n) -->
                        <div class="flex items-center space-x-3 p-2.5 rounded-lg ${item.ordenEnviada ? 'bg-gradient-to-r from-orange-500/10 to-amber-500/10 border border-orange-500/20' : 'bg-zinc-800/30 border border-zinc-700/30'}">
                            <div class="w-8 h-8 rounded-lg ${item.ordenEnviada ? 'bg-gradient-to-br from-orange-500 to-amber-500' : 'bg-zinc-700'} flex items-center justify-center">
                                <i class="fas fa-file-signature text-white text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm ${item.ordenEnviada ? 'text-white' : 'text-zinc-400'} font-medium">
                                    ${item.ordenEnviada || 'Sin orden enviada'}
                                </p>
                                <p class="text-xs ${item.ordenEnviada ? 'text-orange-300' : 'text-zinc-500'}">
                                    ${item.ordenEnviada ? 'üìù Orden a Firmar ‚Ä¢ 5%' : '‚ùå Sin datos'}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Informaci√≥n adicional de la propiedad del XML -->
                        ${xmlData.bedrooms || xmlData.bathrooms || xmlData.floorArea ? `
                        <div class="pt-3 border-t border-white/10">
                            <p class="text-xs text-zinc-400 uppercase tracking-wider mb-2">Detalles de la propiedad</p>
                            <div class="grid grid-cols-3 gap-2">
                                ${xmlData.bedrooms ? `
                                <div class="text-center p-2 rounded-lg bg-white/5">
                                    <div class="text-lg">üõèÔ∏è</div>
                                    <div class="text-xs text-white font-medium">${xmlData.bedrooms}</div>
                                    <div class="text-xs text-zinc-400">Dorm.</div>
                                </div>` : ''}
                                ${xmlData.bathrooms ? `
                                <div class="text-center p-2 rounded-lg bg-white/5">
                                    <div class="text-lg">üöø</div>
                                    <div class="text-xs text-white font-medium">${xmlData.bathrooms}</div>
                                    <div class="text-xs text-zinc-400">Ba√±os</div>
                                </div>` : ''}
                                ${xmlData.floorArea ? `
                                <div class="text-center p-2 rounded-lg bg-white/5">
                                    <div class="text-lg">üìê</div>
                                    <div class="text-xs text-white font-medium">${xmlData.floorArea}m¬≤</div>
                                    <div class="text-xs text-zinc-400">√Årea</div>
                                </div>` : ''}
                            </div>
                        </div>` : ''}
                        
                        <!-- Team Leader Info -->
                        <div class="pt-3 border-t border-white/10">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2 text-xs">
                                    <span class="text-zinc-400">Team Leader:</span>
                                    <span class="${item.teamLeader ? 'text-cyan-300' : 'text-zinc-500'} font-medium">
                                        ${item.teamLeader || 'Sin asignar'}
                                    </span>
                                    <span class="text-xs ${item.teamLeader ? 'bg-cyan-500/20 text-cyan-300' : 'bg-zinc-700/50 text-zinc-500'} px-2 py-0.5 rounded-full">
                                        ${item.teamLeader ? 'üëë' : '‚ùå'}
                                    </span>
                                </div>
                                <div class="flex items-center space-x-1 text-xs text-zinc-400 group-hover:text-cyan-400 transition-colors">
                                    <i class="fas fa-external-link-alt"></i>
                                    <span>Ver detalles</span>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            `;
        }

        // Chart instances
        let chartInstances = {};

        // Update Stats (Dashboard only)
        function updateStats() {
            const totalProperties = allData.length;
            const corredores = new Set(allData.map(item => item.corredor)).size;
            const teamLeaders = new Set(allData.map(item => item.teamLeader).filter(tl => tl && tl.trim())).size;
            
            // Obtener informaci√≥n del XML para estad√≠sticas avanzadas
            const propertiesWithXmlData = allData.filter(item => {
                const xmlData = getPropertyData(item.codigo);
                return xmlData && (xmlData.price || xmlData.propertyType || xmlData.operation);
            });
            
            const xmlCoverage = totalProperties > 0 ? ((propertiesWithXmlData.length / totalProperties) * 100).toFixed(1) : 0;
            
            console.log('üìä Stats Debug:', {
                totalProperties,
                propertiesWithXmlData: propertiesWithXmlData.length,
                xmlCoverage: xmlCoverage + '%',
                corredores,
                teamLeaders
            });
            
            // Estad√≠sticas de precios eliminadas
            
            // Tipos de operaci√≥n
            const ventaCount = allData.filter(item => {
                const xmlData = getPropertyData(item.codigo);
                return xmlData.operation === 'sale';
            }).length;
            
            const arriendoCount = allData.filter(item => {
                const xmlData = getPropertyData(item.codigo);
                return xmlData.operation === 'rent';
            }).length;
            
            // Tipos de propiedades m√°s comunes
            const propertyTypes = {};
            allData.forEach(item => {
                const xmlData = getPropertyData(item.codigo);
                if (xmlData.propertyType) {
                    propertyTypes[xmlData.propertyType] = (propertyTypes[xmlData.propertyType] || 0) + 1;
                }
            });
            
            const mostCommonType = Object.keys(propertyTypes).length > 0 
                ? Object.entries(propertyTypes).sort((a, b) => b[1] - a[1])[0][0]
                : 'N/A';
            
            // Update Dashboard stats
            const dashStats = {
                'dash-totalProperties': totalProperties,
                'dash-totalCorredores': corredores,
                'dash-totalFirmas': teamLeaders
            };

            // Update elements safely
            Object.entries(dashStats).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
            
            // Update additional dashboard metrics
            const additionalMetrics = {
                'properties-growth': propertiesWithXmlData.length > 0 ? `+${((propertiesWithXmlData.length/totalProperties)*100).toFixed(0)}%` : '0%',
                'conversions-today': teamLeaders
            };

            Object.entries(additionalMetrics).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
            
            // Update property types in new container
            const propertyTypesContainer = document.getElementById('propertyTypesContainer');
            if (propertyTypesContainer) {
                propertyTypesContainer.innerHTML = `
                    <div class="grid grid-cols-1 gap-4">
                        <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-amber-500/20 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-home text-amber-400"></i>
                                    </div>
                                    <span class="text-white font-medium">Casas</span>
                                </div>
                                <span class="text-2xl font-bold text-amber-400">0</span>
                            </div>
                        </div>
                        <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-building text-blue-400"></i>
                                    </div>
                                    <span class="text-white font-medium">Departamentos</span>
                                </div>
                                <span class="text-2xl font-bold text-blue-400">0</span>
                            </div>
                        </div>
                        <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-th-large text-purple-400"></i>
                                    </div>
                                    <span class="text-white font-medium">Otros</span>
                                </div>
                                <span class="text-2xl font-bold text-purple-400">${totalProperties}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Update operation types in new container
            const operationContainer = document.getElementById('operationTypesContainer');
            if (operationContainer) {
                operationContainer.innerHTML = `
                    <div class="grid grid-cols-1 gap-4">
                        <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-dollar-sign text-green-400"></i>
                                    </div>
                                    <span class="text-white font-medium">Ventas</span>
                                </div>
                                <span class="text-2xl font-bold text-green-400">${ventaCount}</span>
                            </div>
                        </div>
                        <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-key text-blue-400"></i>
                                    </div>
                                    <span class="text-white font-medium">Arriendos</span>
                                </div>
                                <span class="text-2xl font-bold text-blue-400">${arriendoCount}</span>
                            </div>
                        </div>
                        <div class="bg-white/5 rounded-xl p-4 hover:bg-white/10 transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-gray-500/20 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-question text-gray-400"></i>
                                    </div>
                                    <span class="text-white font-medium">Sin definir</span>
                                </div>
                                <span class="text-2xl font-bold text-gray-400">${totalProperties - ventaCount - arriendoCount}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Update average price display
            const avgPriceElement = document.getElementById('averagePriceDisplay');
            if (avgPriceElement) {
                if (averagePrice > 0) {
                    if (averagePrice > 1000000) {
                        avgPriceElement.textContent = `$${(averagePrice / 1000000).toFixed(1)}M`;
                    } else if (averagePrice > 1000) {
                        avgPriceElement.textContent = `$${(averagePrice / 1000).toFixed(0)}K`;
                    } else {
                        avgPriceElement.textContent = `$${averagePrice.toLocaleString()}`;
                    }
                } else {
                    avgPriceElement.textContent = 'Sin datos';
                }
            }

            // Update property types
            // Update charts
            updateCharts();
            updateActivityFeed();
        }


        // Update Charts
        function updateCharts() {
            updatePerformanceChart();
            updateCorredorRanking();
        }

        // Performance Chart
        function updatePerformanceChart() {
            const ctx = document.getElementById('teamLeaderChart');
            if (!ctx) return;

            // Destroy existing chart
            if (chartInstances.teamLeaderChart) {
                chartInstances.teamLeaderChart.destroy();
            }

            // Get team leader data
            const teamLeaderCounts = {};
            allData.forEach(item => {
                const tl = item.teamLeader || 'Sin Team Leader';
                teamLeaderCounts[tl] = (teamLeaderCounts[tl] || 0) + 1;
            });

            const teamLeaderData = Object.entries(teamLeaderCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8); // Top 8 team leaders

            const colors = [
                '#8B5CF6', '#06B6D4', '#10B981', '#F59E0B', '#EF4444', 
                '#EC4899', '#8B5CF6', '#06B6D4'
            ];

            chartInstances.teamLeaderChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teamLeaderData.map(tl => tl[0]),
                    datasets: [{
                        label: 'Propiedades',
                        data: teamLeaderData.map(tl => tl[1]),
                        backgroundColor: teamLeaderData.map((_, i) => colors[i % colors.length]),
                        borderColor: teamLeaderData.map((_, i) => colors[i % colors.length]),
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(139, 92, 246, 0.5)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const percentage = ((context.parsed.y / allData.length) * 100).toFixed(1);
                                    return `${context.parsed.y} propiedades (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#71717A',
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#71717A',
                                maxRotation: 45,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // Top Corredores Custom Ranking Display
        function updateCorredorRanking() {
            const container = document.getElementById('corredorRankingContainer');
            if (!container) {
                console.log('‚ùå Container corredorRankingContainer no encontrado');
                return;
            }

            // Validar que hay datos
            if (allData.length === 0) {
                container.innerHTML = '<div class="text-center text-zinc-400 py-8">Sin datos disponibles</div>';
                return;
            }

            // Get top corredores
            const corredorCounts = {};
            allData.forEach(item => {
                if (item.corredor && item.corredor.trim()) {
                    corredorCounts[item.corredor] = (corredorCounts[item.corredor] || 0) + 1;
                }
            });

            const topCorredores = Object.entries(corredorCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8); // Top 8 instead of 6

            console.log('üèÜ Top Corredores Ranking:', topCorredores);

            if (topCorredores.length === 0) {
                container.innerHTML = '<div class="text-center text-zinc-400 py-8">No se encontraron corredores</div>';
                return;
            }

            // Generate custom ranking HTML
            let html = '';
            topCorredores.forEach((corredor, index) => {
                const [name, count] = corredor;
                const percentage = ((count / allData.length) * 100).toFixed(1);
                const position = index + 1;
                
                let medalIcon = '';
                let gradientClass = '';
                let borderClass = '';
                
                if (position === 1) {
                    medalIcon = 'ü•á';
                    gradientClass = 'from-yellow-400/20 to-orange-500/20';
                    borderClass = 'border-yellow-500/30';
                } else if (position === 2) {
                    medalIcon = 'ü•à';
                    gradientClass = 'from-gray-300/20 to-gray-500/20';
                    borderClass = 'border-gray-400/30';
                } else if (position === 3) {
                    medalIcon = 'ü•â';
                    gradientClass = 'from-orange-600/20 to-yellow-600/20';
                    borderClass = 'border-orange-500/30';
                } else {
                    medalIcon = `#${position}`;
                    gradientClass = 'from-purple-500/10 to-cyan-500/10';
                    borderClass = 'border-purple-500/20';
                }
                
                html += `
                    <div class="group relative overflow-hidden bg-gradient-to-r ${gradientClass} border ${borderClass} rounded-xl p-4 hover:scale-[1.02] transition-all duration-300 backdrop-blur-sm">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-white/10 font-bold text-lg">
                                    ${medalIcon}
                                </div>
                                <div>
                                    <h4 class="font-bold text-white text-lg group-hover:text-yellow-300 transition-colors">${name}</h4>
                                    <p class="text-sm text-zinc-300">${count} propiedades ‚Ä¢ ${percentage}%</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-white">${count}</div>
                                <div class="w-20 bg-white/20 rounded-full h-2 mt-1">
                                    <div class="h-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500" style="width: ${Math.min(100, (count / (topCorredores[0]?.[1] || 1)) * 100)}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Update Activity Feed
        function updateActivityFeed() {
            const feed = document.getElementById('activity-feed');
            if (!feed) return;

            const activities = allData.slice(-5).reverse().map(item => {
                const time = new Date().toLocaleTimeString('es-ES', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                return `
                    <div class="flex items-center space-x-4 p-4 bg-white/5 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br ${item.firmaOrden ? 'from-green-500 to-emerald-500' : 'from-orange-500 to-amber-500'} flex items-center justify-center">
                            <i class="fas ${item.firmaOrden ? 'fa-check' : 'fa-clock'} text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-white">
                                ${item.firmaOrden ? 'Operaci√≥n firmada' : 'Nueva asignaci√≥n'} ‚Ä¢ ${item.codigo}
                            </p>
                            <p class="text-xs text-zinc-400">
                                ${item.corredor} ‚Üí ${item.referido || 'Sin cliente'} ‚Ä¢ hace ${Math.floor(Math.random() * 30 + 1)} min
                            </p>
                        </div>
                        <div class="text-xs text-zinc-500">
                            ${time}
                        </div>
                    </div>
                `;
            }).join('');

            feed.innerHTML = activities || '<p class="text-center text-zinc-400 py-8">No hay actividad reciente</p>';
        }

        // Export Data
        function exportData() {
            let csv = 'C√≥digo,Corredor,Referido,Estado Firma\n';
            filteredData.forEach(item => {
                csv += `"${item.codigo}","${item.corredor}","${item.referido}","${item.firmaOrden ? 'S√≠' : 'No'}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'propiedades.csv';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('Datos exportados correctamente', 'success');
        }

        // Show Toast Notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transform translate-x-full transition-transform duration-300 ${
                type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', async function() {
            // Filter listeners
            document.getElementById('corredorFilter').addEventListener('change', applyFilters);
            document.getElementById('teamLeaderFilter').addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            
            // Intentar cargar m√°s im√°genes del XML (funciona en producci√≥n)
            loadMoreImagesFromXML();
            
            // Cargar datos adicionales del XML
            loadPropertyDataFromXML();
            
            // Initial load
            await loadData();
            
            // Auto refresh every 60 seconds
            setInterval(() => loadData(true), 60000);
        });
    </script>
</body>
</html>